class CellularAutomaton{constructor(t=13,e=6,i=5,s=5,l=200,a=200,h=5){this.s=t,this.r=e,this.h=i,this.cellSize=s,this.numberHeightCells=l,this.numberWidthCells=a,this.time=h,this.t=0,this.size={},this.grid=document.getElementById("grid").getContext("2d"),this.canvas=document.getElementById("canvas").getContext("2d"),this.y=[],this.yy=[],this.u=[],this.isStart=!1,this.isOneOsc=!1,this.isTwoOsc=!1,this.isObsticle=!1}clearAll(){this.canvas.clearRect(0,0,this.grid.width,this.grid.height),this.grid.clearRect(0,0,this.grid.width,this.grid.height),this.init()}setSizeCanvases(){const t=this.div(document.querySelector(".cells-wrapper").offsetWidth,this.cellSize);this.numberWidthCells=t;const e=this.div(document.querySelector(".cells-wrapper").offsetHeight,this.cellSize);this.numberHeightCells=e,this.grid.canvas.height=e*this.cellSize,this.grid.canvas.width=t*this.cellSize,this.canvas.canvas.height=e*this.cellSize,this.canvas.canvas.width=t*this.cellSize}init(){this.setSizeCanvases(),this.grid.clearRect(0,0,this.grid.width,this.grid.height),this.grid.width=this.cellSize*this.numberWidthCells,this.grid.height=this.cellSize*this.numberHeightCells,this.size={x:this.numberWidthCells,y:this.numberHeightCells},this.gridDraw(),this.createNullArrays()}gridDraw(){this.grid.beginPath();const t=this.numberWidthCells*this.cellSize,e=this.numberHeightCells*this.cellSize;this.grid.strokeStyle="#000",this.grid.lineWidth=1;for(let e=0;e<=this.size.y;e++)this.grid.moveTo(0,e*this.cellSize+.5),this.grid.lineTo(t,e*this.cellSize+.5);for(let t=0;t<=this.size.x;t++)this.grid.moveTo(t*this.cellSize+.5,0),this.grid.lineTo(t*this.cellSize+.5,e);this.grid.stroke()}fillGrid(){this.clearCanvas();for(let t=0;t<this.size.x;t++)for(let e=0;e<this.size.y;e++){this.y[t][e]=this.yy[t][e];let i="Yellow";this.y[t][e]>=1&&this.y[t][e]<=this.r&&(i="Gray",this.fillCell(t,e,i)),this.y[t][e]>6&&this.y[t][e]<=this.s&&this.fillCell(t,e,i),0==this.y[t][e]&&this.fillCell(t,e,"White")}}clearCanvas(){this.canvas.clearRect(0,0,this.grid.width,this.grid.height)}fillCell(t,e,i="Black"){this.canvas.fillStyle=i,this.canvas.fillRect(t*this.cellSize,e*this.cellSize,this.cellSize,this.cellSize)}div(t,e){return(t-t%e)/e}getRandomArbitrary(t,e){return Math.random()*(e-t)+t}createNullArrays(){for(let t=0;t<=this.size.x;t++){this.u[t]=[],this.y[t]=[],this.yy[t]=[];for(let e=0;e<=this.size.y;e++)this.u[t][e]=0,this.y[t][e]=0,this.yy[t][e]=0}}step(){this.t++,this.isOneOsc&&this.osc1(this.t),this.isTwoOsc&&this.osc2(this.t);for(let t=1;t<this.size.x;t++)for(let e=1;e<this.size.y;e++)if(this.y[t][e]>0&&this.y[t][e]<this.s&&(this.yy[t][e]=this.y[t][e]+1),this.y[t][e]==this.s&&(this.yy[t][e]=0,this.u[t][e]=0),0===this.y[t][e])for(let i=t-1;i<=t+1;i++)for(let s=e-1;s<=e+1;s++)this.y[i][s]>0&&this.y[i][s]<=this.r&&this.u[t][e]++,this.u[t][e]>=this.h&&(this.yy[t][e]=1);this.isObsticle&&this.obstacle(),this.fillGrid()}main(){this.isStart&&(this.step(),setTimeout(()=>{this.main()},this.time))}wavesBelousovZhabotinsky(){for(let t=0;t<this.size.x;t++)for(let e=0;e<this.size.y;e++)this.y[t][e]=Math.round(this.getRandomArbitrary(1,400)/10),this.y[t][e]>15&&(this.y[t][e]=0)}oneWave(){this.y[Math.round(this.size.x/2)][Math.round(this.size.y/2)]=1}singleSleeveWave(){for(let t=0;t<this.size.x/2;t++)for(let e=0;e<this.s;e++)this.y[Math.round(this.size.x/2)+e][t]=e}doubleSleeveWave(){for(let t=0;t<this.numberWidthCells/2;t++)for(let e=0;e<this.s;e++)this.y[20+e][t]=e,t>20&&(this.y[20+e][t]=14-e)}osc1(t){t==20*Math.round(t/20)&&(this.y[30][30]=1)}osc2(t){t==30*Math.round(t/30)&&(this.y[20][50]=1)}obstacle(){for(let t=0;t<this.numberWidthCells;t++)this.yy[t][30]=0,this.yy[t][31]=0}}const controlPanel=document.querySelector(".control__panel"),grid=document.querySelector("#cb4"),s=document.querySelector(".s"),r=document.querySelector(".r"),h=document.querySelector(".h"),cellSize=document.querySelector(".cell-size"),cellsH=document.querySelector(".cellsH"),cellsW=document.querySelector(".cellsW"),time=document.querySelector(".time"),inputs=document.querySelector(".control__panel-inputs"),radioBox=document.querySelector(".control__panel-radiogroup"),oneOsc=document.querySelector("#oneOsc"),twoOsc=document.querySelector("#twoOsc"),obsticle=document.querySelector("#obsticle"),step=document.querySelector(".step"),start=document.querySelector(".start"),reset=document.querySelector(".reset");let automat=new CellularAutomaton(s.value,r.value,h.value,cellSize.value,cellsH.value,cellsW.value,time.value);function chooseReaction(){switch(+document.querySelector("input[name=radio-cust]:checked").value){case 1:automat.wavesBelousovZhabotinsky();break;case 2:automat.oneWave();break;case 3:automat.singleSleeveWave();break;case 4:automat.doubleSleeveWave()}}function dragElement(t){let e=0,i=0,s=0,l=0;function a(t){(t=t||window.event).preventDefault(),s=t.clientX,l=t.clientY,document.onmouseup=o,document.onmousemove=h}function h(a){(a=a||window.event).preventDefault(),e=s-a.clientX,i=l-a.clientY,s=a.clientX,l=a.clientY,t.style.top=t.offsetTop-i+"px",t.style.left=t.offsetLeft-e+"px"}function o(){document.onmouseup=null,document.onmousemove=null}document.querySelector(`.${t.className}-header`)?document.querySelector(`.${t.className}-header`).onmousedown=a:t.onmousedown=a}automat.init(),chooseReaction(),obsticle.addEventListener("click",()=>{automat.isObsticle=!!obsticle.checked}),oneOsc.addEventListener("click",()=>{automat.isOneOsc=!!oneOsc.checked}),twoOsc.addEventListener("click",()=>{automat.isTwoOsc=!!twoOsc.checked}),inputs.addEventListener("click",()=>{automat.s=s.value,automat.r=r.value,automat.h=h.value,automat.cellSize=cellSize.value,automat.cellsH=cellsH.value,automat.cellsW=cellsW.value,automat.time=time.value}),radioBox.addEventListener("click",()=>{start.value="Запуск",automat.isStart=!1,automat.init(),chooseReaction()}),grid.addEventListener("click",()=>{document.querySelector("#grid").hidden=!grid.checked}),step.addEventListener("click",()=>{start.value="Запуск",automat.isStart=!1,automat.step()}),start.onclick=()=>{start.value=automat.isStart?"Запуск":"Стоп",automat.isStart=!automat.isStart,automat.s=s.value,automat.r=r.value,automat.h=h.value,automat.cellSize=cellSize.value,automat.cellsH=cellsH.value,automat.cellsW=cellsW.value,automat.time=time.value,automat.main()},reset.addEventListener("click",()=>{automat.isStart=!1,automat.init(),chooseReaction(),start.value="Запуск"}),dragElement(controlPanel);